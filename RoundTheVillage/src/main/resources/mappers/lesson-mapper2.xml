<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="lessonMapper2">
	
	<resultMap type="LessonReview" id="lessonreview_rm">
		<id property="revNo" column="REV_NO"/>
		<result property="revContent" column="REV_CONTENT"/>
		<result property="revCreateDt" column="REV_CREATE_DT"/>
		<result property="revRating" column="REV_RATING"/>
		<result property="lesNo" column="LES_NO"/>
		<result property="memberNo" column="MEMBER_NO"/>
	</resultMap>
	
	<resultMap type="LessonQuestion" id="lessonquestion_rm">
		<id property="queNo" column="QUE_NO"/>
		<result property="queDt" column="QUE_DT"/>
		<result property="queContent" column="QUE_CONTENT"/>
		<result property="lesNo" column="LES_NO"/>
		<result property="memberNo" column="MEMBER_NO"/>
		<result property="queType" column="QUE_TYPE"/>
		<result property="queParentNo" column="QUE_PARENT_NO"/>
	</resultMap>
	
	<insert id="insertReview" parameterType="LessonReview">
		INSERT INTO LESSON_REVIEW 
		VALUES (SEQ_LRVNO.NEXTVAL, #{revContent}, DEFAULT, #{revRating}, #{lesNo}, 1)
	</insert>

	<select id="selectReview" parameterType="_int" resultMap="lessonreview_rm">
		SELECT * FROM LESSON_REVIEW 
		WHERE LES_NO = #{lesNo}
		ORDER BY REV_NO DESC 
	</select>
	
	<update id="updateReview" parameterType="LessonReview">
		UPDATE LESSON_REVIEW SET REV_CONTENT = #{revContent}
		WHERE REV_NO = #{revNo}
	</update>
	
	<delete id="deleteReview" parameterType="_int">
		DELETE LESSON_REVIEW
		WHERE REV_NO = #{revNo}
	</delete>
	
	<select id="selectQuestion" parameterType="_int" resultMap="lessonquestion_rm">
		SELECT * FROM LESSON_QUESTION
		WHERE LES_NO = #{lesNo}
		ORDER BY QUE_PARENT_NO DESC, QUE_TYPE DESC
	</select>
	
	<insert id="insertQuestion" parameterType="LessonQuestion">
		INSERT INTO LESSON_QUESTION VALUES(SEQ_LQUNO.NEXTVAL, DEFAULT, #{queContent}, #{lesNo}, 1, 'Q', SEQ_LQUNO.CURRVAL)
	</insert>
	
	<insert id="insertAnswer" parameterType="LessonQuestion">
		INSERT INTO LESSON_QUESTION VALUES(SEQ_LQUNO.NEXTVAL, DEFAULT, #{queContent}, #{lesNo}, 1, 'A', #{queParentNo})
	</insert>

	<delete id="deleteQuestion" parameterType="_int">
		DELETE LESSON_QUESTION 
		WHERE QUE_NO = #{queNo}
	</delete>
	
	<update id="updateQuestion" parameterType="LessonQuestion">
		UPDATE LESSON_QUESTION SET QUE_CONTENT = #{queContent}
		WHERE QUE_NO = #{queNo}
	</update>
	
</mapper>
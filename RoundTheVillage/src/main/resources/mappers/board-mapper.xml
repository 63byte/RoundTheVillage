<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boardMapper">

<resultMap type="Board" id="board_rm">
	<id property="boardNo" column="BOARD_NO"/>
	
	<result property="boardTitle" column="BOARD_TITLE"/>
	<result property="boardContent" column="BOARD_CONTENT"/>
	<result property="memberNo" column="MEMBER_NO"/>
	<result property="readCount" column="BOARD_STATUS"/>
	<result property="boardCreateDate" column="BOARD_C_DT"/>
	<result property="boardModifyDate" column="BOARD_M_DT"/>
	<result property="boardStatus" column="BOARD_STATUS"/>
	<result property="classNo" column="CLA_NO"/>
	<result property="classCategoryNo" column="CS_CATE_NO"/>
</resultMap>

<resultMap type="Attachment" id="attachment_rm">
	<id property="fileNo" column="ATTACHMENT_NO"/>
	<result property="fileName" column="B_FILE_NAME"/>
	<result property="fileLevel" column="B_FILE_LEVEL"/>
	<result property="fileCreateDate" column="B_FILE_DT"/>
	<result property="filePath" column="B_FILE_PATH"/>
	<result property="boardNo" column="BOARD_NO"/>
</resultMap>



<!-- 전체 게시글 수 조회 -->
<select id="getListCount" parameterType="_int" resultType="_int">
	SELECT COUNT(*) FROM V_BOARD
	WHERE BOARD_STATUS = 'Y'
</select>

<!-- 게시글 목록 조회 -->
<select id="selectList" parameterType="_int" resultMap="board_rm">
   SELECT BOARD_NO, BOARD_TITLE, READ_COUNT
   FROM V_BOARD
   WHERE BOARD_STATUS = 'Y'
   ORDER BY BOARD_NO DESC
</select>

<!-- 썸네일 목록 조회 -->
<select id="selectThumbnailList" parameterType="list" resultMap="attachment_rm">
   SELECT * FROM B_ATTACHMENT
   WHERE B_FILE_LEVEL = 0
   AND BOARD_NO IN
   <foreach collection="list" item="board" separator=", " open="(" close=")">
      #{board.boardNo}
   </foreach>
</select>


<!-- 게시글 상세 조회 -->
<select id="selectBoard" parameterType="_int" resultMap="board_rm">
	SELECT BOARD_NO, BOARD_TITLE, BOARD_CONTENT,
				BOARD_C_DT, BOARD_M_DT, READ_COUNT,
				CLA_NO, CS_CATE_NO, MEM_NICKNAME
	FROM V_BOARD
	WHERE BOARD_STATUS = 'Y'
	AND BOARD_NO = #{boardNo}
	AND CLA_NO = #{classNo}
</select>


<!-- 다음 게시글 번호 조회 -->
<select id="selectNextNo" resultType="_int">
	SELECT SEQ_BNO.NEXTVAL FROM DUAL
</select>

<!-- 게시글 삽입  -->
	<insert id="insertBoard" parameterType="map">
	INSERT INTO BOARD VALUES
	(#{boardNo}, #{boardTitle}, #{boardContent},
		DEFAULT, DEFAULT, DEFAULT, DEFAULT, #{memberNo},
		#{classNo}, #{classCategoryNo})
	</insert>



</mapper>